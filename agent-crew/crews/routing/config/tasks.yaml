routing_task:
  description: >
    당신은 아주대학교의 이메일 라우팅을 담당하는 매우 유능하고 꼼꼼한 AI 조교입니다.
    당신의 임무는 [학생 이메일 정보]와 [업무 처리 규칙]을 분석하여 가장 적합한 담당자 한 명을 찾아내는 것입니다.

    **'조직도 및 업무 분장표 로드 도구' 도구를 호출하여 [전체 업무 분장표] 데이터를 확보하십시오.**
    
    확보된 [전체 업무 분장표]를 바탕으로 [업무 처리 규칙]에 따라 최적의 담당자를 매칭합니다.

    [학생 이메일 정보]:
    - 보낸 사람: {sender}
    - 제목: {subject}
    - 본문: {body}
    
    **[업무 처리 규칙]**
    1.  **문의 대상 파악**: 먼저 **학생 이메일 제목/본문**을 분석하여 학생이 어느 '학과' 또는 '부서'에 문의하는지 파악합니다. 이것이 가장 중요한 단서입니다.
    2.  **보낸 사람 정보 활용**: 만약 **학생 이메일 제목/본문**에 명확한 대상 학과가 없다면, [보낸 사람 정보]를 참고하여 학생 자신의 소속 학과에 문의하는 것으로 간주합니다. (예: 단순히 '성적 문의'라고만 적혀 있을 경우)
    3.  **핵심 업무어 분석**: '전과', '복수전공', '졸업', '장학금', '수강신청', '휴학', '증명서', '서버 문제' 등 핵심적인 업무 관련 단어를 추출합니다.
    4.  **최적 담당자 매칭**: 위에서 파악한 '문의 대상 학과'와 '핵심 업무어'를 바탕으로, [전체 업무 분장표]에서 가장 담당업무가 일치하는 직원 한 명을 찾습니다. 총괄 책임자보다는 실무 담당자를 우선으로 찾아주세요.
    5.  **총괄 배정 예외 규칙**: 만약 적합한 실무자를 찾기 어렵거나 문의 내용이 단과대 또는 학과 전체의 정책과 같이 매우 포괄적인 사안이라고 판단될 경우에만 예외적으로 '총괄' 책임자에게 배정합니다.
    6.  **복합 조건 판단 (특수 신분 학생)**: 학생의 신분이 '외국인', '교환학생' 등으로 파악될 경우, 한 단계 더 나아가 문의의 **핵심 주제**를 반드시 파악해야 합니다.
        - (A) 수강신청, 학점, 졸업요건 등 소속 학과의 학사 관련 문의: 이 경우, 유학생이라 할지라도 해당 학생의 **소속 학과 내 학사 담당자**에게 배정하는 것이 원칙입니다.
        - (B) 비자, 출입국, 외국인 등록, 기숙사 등 유학생 생활/행정 관련 문의: 이 경우, **국제교류팀 또는 유학생 전담 담당자**가 있다면 우선적으로 배정합니다.
    7.  **정확한 출력**: 찾은 담당자의 이름과 이메일을 정확히 출력해야 합니다.

    위의 규칙에 따라 단계적으로 생각하여 최적의 담당자를 찾아주세요.
  expected_output: >
    분석 결과를 `RoutingResult` Pydantic 모델의 JSON 형식으로 반환합니다.
    반드시 'recipient_name', 'recipient_email' 키를 포함해야 합니다.
  agent: email_routing_agent

validate_duty_task:
  description: >
    **[STEP 1: 업무 적절성 검증]**
    'routing_task'에서 1차 배정된 담당자의 '업무 적절성'을 검증합니다.

    **[입력 정보 (컨텍스트에서 확인)]**
    - 1차 담당자 이메일 ('recipient_email')
    - 문의 원본 요약: {email_summary}
    
    **[작업 지침]**
    1.  `조직도 및 업무 분장표 로드 도구`을 **반드시 호출**하여 [전체 업무 분장표]를 가져옵니다.
    2.  [전체 업무 분장표]에서 'recipient_email'의 [담당 업무] 설명을 정확히 추출합니다.
    3.  추출한 [담당 업무]와 {email_summary}를 비교하여, 업무가 일치하는지 판단합니다.
  expected_output: >
    검증 결과를 `DutyValidationResult` Pydantic 모델의 JSON 형식으로 반환합니다.
    - 업무 일치 시: `status: "Success"`, `reasoning: "업무 일치."`
    - 업무 불일치 시: `status: "Failed"`, `reasoning: "업무 불일치: {담당자의 실제 업무 요약}"`
  agent: assignee_validation_agent

validate_schedule_task:
  description: >
    **[STEP 2: 스케줄 가용성 검증]**
    'validate_duty_task'를 통과한 담당자의 '스케줄 가용성'을 검증합니다.

    **[입력 정보 (컨텍스트에서 확인)]**
    - 1차 담당자 이메일 ('recipient_email')
    - [STEP 1]의 결과 ('DutyValidationResult' JSON)
    
    **[작업 지침]**
    1.  먼저, 'validate_duty_task'의 `status`가 "Success"인지 확인합니다.
    2.  **(판단 1)** "Success"가 아니면, 즉시 STEP 1의 실패 사유를 그대로 포함하여 'Failed'를 반환합니다.
    3.  **(판단 2)** "Success"인 경우에만, `칸반 보드 사용자 상태 조회 도구`을 'recipient_email' 인수로 **반드시 호출**합니다.
    4.  반환된 '담당자의 실제 스케줄 상태'를 확인합니다.
    5.  'Available'이 아니면 'Failed'를, 'Available'이면 'Success'를 반환합니다.
  expected_output: >
    **최종 검증 결과**를 `FinalAssigneeResult` Pydantic 모델의 JSON 형식으로 반환합니다.
    - 최종 성공 시: `status: "Success"`, `reasoning: "업무 일치 및 스케줄 가용함."`
    - 스케줄 실패 시: `status: "Failed"`, `reasoning: "업무는 적절하나, 스케줄 검증 실패: {담당자의 실제 스케줄 상태}"`
    - (STEP 1에서 이미 실패한 경우): STEP 1의 'reasoning'을 그대로 사용.
  agent: assignee_validation_agent